!function(t,i){"use strict";var s=function(){var s=i,l=s.body,n=s.createElement("div"),e=n.style,r=["webkit","Moz","ms","O"],o=0,h=r.length,a=function(t){return t.replace(/-\D/g,function(t){return t.charAt(1).toUpperCase()})},u=function(t,i,s){if("string"==typeof i)return t.addEventListener(i,s,!1);for(var l=0,n=i.length;n>l;l++)t.addEventListener(i[l],s,!1)},c=function(t){var i=a(t);if(i in e)return i;for(o=0;h>o;o++)if(i=a(r[o]+"-"+t),i in e)return i;return null},p=function(t){var i=a(t);if(i in e)return!0;for(o=0;h>o;o++)if(i=a(r[o]+"-"+t),i in e)return!0;return!1},f=function(){var i,s;return l.appendChild(n),p("transform")&&(s=c("transform"),n.style[s]="translate3d(1px,1px,1px)",i=t.getComputedStyle(n,null)[s]),l.removeChild(n),void 0!==i&&i.length>0&&"none"!==i},d=Date.now||function(){return(new Date).getTime()},m=function(t,i,s,l,n,e){var r,o,h=t-i,a=Math.abs(h)/s;return e=void 0===e?6e-4:e,r=t+a*a/(2*e)*(0>h?-1:1),o=a/e,l>r?(r=n?l-n/2.5*(a/8):l,h=Math.abs(r-t),o=h/a):r>0&&(r=n?n/2.5*(a/8):0,h=Math.abs(t)+r,o=h/a),{destination:Math.round(r),duration:o}};return{on:u,prefix:c,hasTransition:p("transition"),hasTransform2d:p("transform"),hasTransform3d:f(),getTime:d,momentum:m}}(),l=s.prefix("transition"),n=s.prefix("transform"),e=function(t,s){s=s||{},this.wrapper="string"==typeof t?i.querySelector(t):t,this.scroller=this.wrapper.children[0],this.direction=s.direction||"top",this.display=!!s.display||!1,this.prevent=s.prevent===!1?!1:!0,this.useTransform=s.useTransform===!1?!1:!0,this.scrollStart=s.scrollStart||function(){},this.scrollMove=s.scrollMove||function(){},this.scrollEnd=s.scrollEnd||function(){},this.scrollCancel=s.scrollCancel||function(){},this.usePullDown=s.usePullDown||!1,this.usePullUp=s.usePullUp||!1,this.pullDownOffset=s.pullDownOffset||50,this.pullUpOffset=s.pullUpOffset||50,this.pullDown=s.pullDown||function(){},this.pullUp=s.pullUp||function(){},this.pullDownStart=s.pullDownStart||function(){},this.pullUpStart=s.pullUpStart||function(){},this.pullDownEnd=s.pullDownEnd||function(){},this.pullUpEnd=s.pullUpEnd||function(){},this.pullDownCancel=s.pullDownCancel||function(){},this.pullUpCancel=s.pullUpCancel||function(){},this.$locked=!1,this.x=this.y=0,this.maxScrollX=this.maxScrollY=0,this._events={},this._init()};e.prototype={_init:function(){this.display&&this._initBar(),this.$refresh(),this._initEvent()},_setup:function(){"top"===this.direction?(this.wrapperH=this.wrapper.offsetHeight,this.scrollerH=this.scroller.offsetHeight,this.maxScrollY=this.wrapperH-this.scrollerH,this.maxScrollY>0&&(this.maxScrollY=0)):"left"===this.direction&&(this._setCss(),this.wrapperW=this.wrapper.offsetWidth,this.scrollerW=this.scroller.offsetWidth,this.maxScrollX=this.wrapperW-this.scrollerW,this.maxScrollX>0&&(this.maxScrollX=0))},_setCss:function(){for(var t=this.scroller.children,i=0,s=t.length,l=0;s>i;i++)l+=t[i].offsetWidth;this.scroller.style.width=l+"px"},_initEvent:function(){s.on(this.wrapper,"touchstart",this._start.bind(this)),s.on(this.wrapper,"touchmove",this._move.bind(this)),s.on(this.wrapper,"touchend",this._end.bind(this)),s.on(this.scroller,["webkitTransitionEnd","transitionend"],this._transitionEnd.bind(this)),s.on(t,["resize","orientationchange"],this._resize.bind(this)),this.$on("scrollStart",this.scrollStart),this.$on("scrollMove",this.scrollMove),this.$on("scrollEnd",this.scrollEnd),this.$on("scrollCancel",this.scrollCancel),this.$on("pullDown",this.pullDown),this.$on("pullUp",this.pullUp),this.$on("pullDownStart",this.pullDownStart),this.$on("pullUpStart",this.pullUpStart),this.$on("pullDownEnd",this.pullDownEnd),this.$on("pullUpEnd",this.pullUpEnd),this.$on("pullDownCancel",this.pullDownCancel),this.$on("pullUpCancel",this.pullUpCancel)},_start:function(t){t.touches&&(this.startX=t.touches[0].pageX,this.startY=t.touches[0].pageY,this.startTime=s.getTime(),this.distX=this.distY=0,this.moveX=this.moveY=null,this.fixed="",this.moved=!1,this.isPullDown=this.isPullUp=!1,this.scrollX=this.x,this.scrollY=this.y,s.hasTransition?this._transition():clearTimeout(this.aTimer))},_move:function(t){if(t.touches&&(this.prevent&&t.preventDefault(),!this.$locked)){var i=t.touches[0].pageX,l=t.touches[0].pageY,n=null===this.moveX?0:i-this.moveX,e=null===this.moveY?0:l-this.moveY,r=s.getTime();""===this.fixed&&(Math.abs(l-this.startY)>Math.abs(i-this.startX)?this.fixed="top":this.fixed="left"),this.moved||(this.moved=!0,this._trigger("scrollStart")),"top"===this.fixed&&"top"===this.direction?((this.y>0||this.y<this.maxScrollY)&&(e/=4),this.distY+=e,this._translate(0,this.y+e)):"left"===this.fixed&&"left"===this.direction&&((this.x>0||this.x<this.maxScrollX)&&(n/=4),this.distX+=n,this._translate(this.x+n,0)),this._pullStart(),this.moveX=i,this.moveY=l,r-this.startTime>=300&&(this.startTime=r,this.scrollX=this.x,this.scrollY=this.y)}},_end:function(t){if(t.changedTouches){if(!this.moved)return void this._trigger("scrollCancel");if(this._pullEnd()&&this._resetPosition()){var i=s.getTime()-this.startTime,l=this.x,n=this.y,e=0,r={};if(300>i&&(Math.abs(this.distY)>10||Math.abs(this.distX)>10)){if("top"===this.direction)return r=s.momentum(this.y,this.scrollY,i,this.maxScrollY,this.wrapperH),n=Math.round(r.destination),e=Math.round(r.duration),n===this.y?void this._trigger("scrollCancel"):this.$scrollTo(0,n,e);if("left"===this.direction)return r=s.momentum(this.x,this.scrollX,i,this.maxScrollX,this.wrapperW),l=Math.round(r.destination),e=Math.round(r.duration),l===this.x?void this._trigger("scrollCancel"):this.$scrollTo(l,0,e)}this._trigger("scrollEnd")}}},_transitionEnd:function(){s.hasTransition?this._transition():clearTimeout(this.aTimer),this.isPullDown||this.isPullUp||this._resetPosition()&&this._trigger("scrollEnd")},_resetPosition:function(){if(this.y>0||this.x>0)return this.$scrollTo(0,0,400),!1;if("top"===this.direction){if(this.y<this.maxScrollY)return this.$scrollTo(0,this.maxScrollY,400),!1}else if("left"===this.direction&&this.x<this.maxScrollX)return this.$scrollTo(this.maxScrollX,0,400),!1;return!0},_resize:function(){var t=!1,i=null;("top"===this.direction&&this.y===this.maxScrollY||"left"===this.direction&&this.x===this.maxScrollX)&&(t=!0),i&&clearTimeout(i),i=setTimeout(function(){this.$refresh(),t&&(this._transition(),"top"===this.direction?this._translate(0,this.maxScrollY):"left"===this.direction&&this._translate(this.maxScrollX,0))}.bind(this),60)},_transition:function(t){t=t||0,this.scroller.style[l]="all "+t+"ms",this._trigger("transition",t)},_translate:function(t,i){this.useTransform&&s.hasTransform3d?this.scroller.style[n]="translate3d("+t+"px,"+i+"px, 0px)":this.useTransform&&s.hasTransform2d?this.scroller.style[n]="translate("+t+"px,"+i+"px)":(this.scroller.style.left=t+"px",this.scroller.style.top=i+"px"),this._trigger("scrollMove",t,i),this.x=t,this.y=i},_animate:function(t,i,l){var n=this,e=this.x,r=this.y,o=t-e,h=i-r,a=s.getTime(),u=l,c=function(t){return Math.sqrt(1- --t*t)};!function p(){var l=s.getTime(),f=l-a,d=c(f/u),m=e+d*o,x=r+d*h;return n._translate(m,x),f>=u?(n._translate(t,i),void n._transitionEnd()):void(n.aTimer=setTimeout(p,10))}()},$scrollTo:function(t,i,l){s.hasTransition?(this._transition(l),this._translate(t,i)):this._animate(t,i,l)},$moveTo:function(t,s,l){if(t="string"==typeof t?i.querySelector(t):t){var n=0,e=0;"top"===this.direction?(e=-t.offsetTop,1==!!l&&(e+=(this.wrapperH-t.offsetHeight)/2)):"left"===this.direction&&(n=-t.offsetLeft,1==!!l&&(n+=(this.wrapperW-t.offsetWidth)/2)),e>0&&(e=0),e<this.maxScrollY&&(e=this.maxScrollY),n>0&&(n=0),n<this.maxScrollX&&(n=this.maxScrollX),this.$scrollTo(n,e,s||400)}},_pullStart:function(){this.usePullDown&&(this.y>0||this.x>0)&&(this._trigger("pullDown"),!this.isPullDown&&(this.y>this.pullDownOffset||this.x>this.pullDownOffset)&&(this.isPullDown=!0,this._trigger("pullDownStart"))),this.usePullUp&&(this.y<this.maxScrollY||this.x<this.maxScrollX)&&(this._trigger("pullUp"),!this.isPullUp&&(this.y<this.maxScrollY-this.pullUpOffset||this.x<this.maxScrollX-this.pullUpOffset)&&(this.isPullUp=!0,this._trigger("pullUpStart"))),"top"===this.direction?(this.isPullDown&&this.y<=this.pullDownOffset&&(this.isPullDown=!1,this._trigger("pullDownCancel")),this.isPullUp&&this.y>=this.maxScrollY-this.pullUpOffset&&(this.isPullUp=!1,this._trigger("pullUpCancel"))):"left"===this.direction&&(this.isPullDown&&this.x<=this.pullDownOffset&&(this.isPullDown=!1,this._trigger("pullDownCancel")),this.isPullUp&&this.x>=this.maxScrollX-this.pullUpOffset&&(this.isPullUp=!1,this._trigger("pullUpCancel")))},_pullEnd:function(){return this.isPullDown?(this._trigger("pullDownEnd",this.pullDownOffset,this.pullDownOffset),!1):this.isPullUp?(this._trigger("pullUpEnd",this.maxScrollX-this.pullUpOffset,this.maxScrollY-this.pullUpOffset),!1):!0},_initBar:function(){function t(){"top"===g.direction?(x=g.wrapperH/g.scrollerH,x>1&&(x=1),p.style.height=g.wrapperH*x+"px"):"left"===g.direction&&(m=g.wrapperW/g.scrollerW,m>1&&(m=1),p.style.width=g.wrapperW*m+"px")}function e(){clearTimeout(f),d=setTimeout(h,300)}function r(){clearTimeout(d),f=setTimeout(o,100)}function o(){c.style[l]="all 200ms",c.style.opacity=1}function h(){c.style[l]="all 500ms",c.style.opacity=0}function a(t){p.style[l]="all "+t+"ms"}function u(t,i){s.hasTransform3d?p.style[n]="translate3d("+-t*m+"px,"+-i*x+"px, 0px)":s.hasTransform2d?p.style[n]="translate("+-t*m+"px,"+-i*x+"px)":(p.style.left=-t*m+"px",p.style.top=-i*x+"px")}var c=null,p=null,f=null,d=null,m=1,x=1,g=this;!function(){c=i.createElement("div"),p=i.createElement("div"),"top"===g.direction?(c.style.cssText="opacity:0;position:absolute;z-index:8888888;width:3px;bottom:0;top:0;right:2px;overflow:hidden;",p.style.cssText="position:absolute;left:0;top:0;width:3px;background:rgba(0,0,0,0.35);border-radius:3px;"):"left"===g.direction&&(c.style.cssText="opacity:0;position:absolute;z-index:8888888;height:2px;left:0;right:0;bottom:1px;overflow:hidden;",p.style.cssText="position:absolute;left:0;top:0;height:2px;background:rgba(0,0,0,0.35);border-radius:3px;"),c.appendChild(p),g.wrapper.appendChild(c)}(),this.$on("refresh",function(){setTimeout(t,100)}),this.$on("scrollStart",function(){r()}),this.$on("scrollMove",function(t,i){u(t,i)}),this.$on("scrollCancel",function(){e()}),this.$on("scrollEnd",function(){e()}),this.$on("transition",function(t){a(t)}),this.$on("pullDownEnd",function(){e()}),this.$on("pullUpEnd",function(){e()})},_trigger:function(t){if(this._events[t]){var i=0,s=this._events[t].length;if(s)for(;s>i;i++)this._events[t][i].apply(this,[].slice.call(arguments,1))}},$refresh:function(){this._setup(),this._trigger("refresh")},$on:function(t,i){this._events[t]||(this._events[t]=[]),this._events[t].push(i)},$off:function(t,i){if(this._events[t]){var s=this._events[t].indexOf(i);s>-1&&this._events[t].splice(s,1)}}},"function"==typeof define&&(define.amd||define.cmd)?define("mScroll",[],function(){return e}):t.mScroll=e}(window,document);